import{d as $,r as a,h as q,c as d,b as n,e as T,F as M,i as H,f as A,j as G,v as J,k as O,w as P,t as x,u as Q,m as S,n as L,o as u,l as X,p as Y,_ as Z}from"./index-D_IbfUJW.js";import{g as U,c as ee}from"./auth-DVO-hNf6.js";function te(){function b(v){const p=/<code>(.*?)<\/code>/gs;try{return v.replace(/\\n\\n/g,"<br>").replace(/\\n/g,"<br>").replace(/\\t/g,"	").replace(/\\"/g,'"').replace(/\'/g,"'").replace(/\\\\/g,"\\").replace(/\\u([\dA-F]{4})/gi,(c,o)=>String.fromCharCode(parseInt(o,16))).replace(p,(c,o)=>`
          <div class="code-container">
            <pre class="code">
              <code>${o}</code>
            </pre>
          </div>`)}catch(r){return console.error("转义失败，返回原始文本:",r),v}}return{unescapeText:b}}const se={class:"chat-container"},ne=["innerHTML"],ae={key:0,class:"typing-indicator"},oe={class:"input-area"},ie={class:"input-container"},le=["onKeydown","disabled"],re={class:"button-group"},ce=["disabled"],de=["disabled"],ue={class:"history-list"},ve=["onClick"],pe={class:"session-title"},ge={class:"session-time"},me={key:0},he=$({__name:"AIClient",setup(b){const v=Q(),p=a(null),r=a(null),c=a(""),o=a(""),h=a([{text:"你好",isUser:!0},{text:"感谢您的提问。关于这个问题，最新的研究显示...",isUser:!1}]),f=a(!1),l=a(!1),y=a("kimi"),_=a(void 0),{unescapeText:I}=te(),D=a([]),V=a(!1);a(!1);const B=async()=>{const s=sessionStorage.getItem("sessionId");if(!s){v.push("/chat-history");return}_.value=parseInt(s,10)},N=async()=>{var i;const s=sessionStorage.getItem("sessionId");if(!s)return;const e=await U(Number(s)),t=Array.isArray((i=e.data)==null?void 0:i.messages)?e.data.messages:[];h.value=t.map(m=>({text:I(S(m.content)),isUser:m.role==="user"})),k()};q(()=>{B(),N()});const R=s=>{const t=(typeof s=="string"?s:s.renderedHtml).length;return t<20?"60%":t<50?"75%":"85%"},z=s=>{const e=s.target,t=e.value;c.value=t;const i=parseInt(getComputedStyle(e).lineHeight),m=parseInt(getComputedStyle(e).paddingTop)+parseInt(getComputedStyle(e).paddingBottom);if(e.scrollHeight>i*4+m){const w=t.split(`
`).slice(-4).join(`
`);o.value=w,L(()=>{r.value&&(r.value.selectionStart=r.value.selectionEnd=w.length)})}else o.value=t},g=(s,e)=>{s=I(S(s??"")),h.value.push({text:s,isUser:e}),k()},E=()=>{f.value=!0,k()},F=()=>{f.value=!1},k=()=>{L(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})},C=async()=>{if(l.value||!c.value.trim())return;const s=c.value.trim();l.value=!0,g(s,!0),c.value="",o.value="",E();try{const e=_.value||sessionStorage.getItem("sessionId"),t=e?Number(e):void 0;if(!t){g("会话ID不存在",!1),l.value=!1;return}const i=await ee({content:s,name:y.value,sessionId:t});g(I(S(i.data)),!1)}catch(e){g("请求AI服务时出错，请稍后再试",!1),console.error("Error:",e)}finally{F(),l.value=!1}};function K(){_.value=void 0,v.push("/chat-history")}const j=async s=>{const e=await U(s.sessionId);sessionStorage.setItem("sessionId",e.data.sessionId.toString()),v.push({path:"/ai"})},W=s=>new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(s,e)=>(u(),d("div",se,[n("div",{ref_key:"chatMessages",ref:p,class:"chat-messages"},[(u(!0),d(M,null,H(h.value,(t,i)=>(u(),d("div",{key:i,class:Y(["message",t.isUser?"user-message":"ai-message"]),style:X({"max-width":R(t.text)})},[n("div",{innerHTML:typeof t.text=="string"?t.text:t.text.renderedHtml},null,8,ne)],6))),128)),f.value?(u(),d("div",ae,e[2]||(e[2]=[n("div",{class:"typing-dot"},null,-1),n("div",{class:"typing-dot"},null,-1),n("div",{class:"typing-dot"},null,-1)]))):T("",!0)],512),n("div",oe,[n("div",ie,[A(n("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),class:"model-select"},e[3]||(e[3]=[n("option",{value:"kimi"},"kimi",-1),n("option",{value:"deepseek"},"deepseek",-1)]),512),[[G,y.value]]),A(n("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value=t),onInput:z,onKeydown:O(P(C,["prevent"]),["enter"]),placeholder:"输入您的问题...",class:"message-input",disabled:l.value,rows:"4",ref_key:"textareaRef",ref:r},null,40,le),[[J,o.value]]),n("div",re,[n("button",{onClick:K,class:"clear-button",disabled:l.value}," 历史对话 ",8,ce),n("button",{onClick:C,class:"send-button",disabled:l.value||!c.value.trim()},x(l.value?"发送中...":"发送"),9,de)])])]),n("div",ue,[(u(!0),d(M,null,H(D.value,t=>(u(),d("div",{key:t.sessionId,class:"history-item",onClick:i=>j(t)},[n("div",pe,x(t.title),1),n("div",ge,x(W(t.createTime)),1)],8,ve))),128)),V.value?(u(),d("div",me,"加载中...")):T("",!0)])]))}}),ke=Z(he,[["__scopeId","data-v-bd52dd12"]]);export{ke as default};
